<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To My Love</title>
    <style>
        /* --- å…¨å±€æ ·å¼ --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
            background: #ffe6e6; /* æµªæ¼«ç²‰èƒŒæ™¯ */
            overflow: hidden; /* ç¦æ­¢æ»šåŠ¨ */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #4a4a4a;
        }

        /* èƒŒæ™¯çˆ±å¿ƒç”»å¸ƒ */
        #heart-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 90%;
            text-align: center;
            display: none; /* åˆå§‹éšè— */
            animation: fadeIn 1s ease;
            max-height: 90vh; /* é˜²æ­¢å†…å®¹å¤ªé•¿æº¢å‡º */
            overflow-y: auto; /* å†…å®¹è¿‡å¤šå¯æ»šåŠ¨ */
        }

        /* åˆå§‹é®ç½©å±‚ */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffb3b3;
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.8s;
        }

        .start-screen h1 {
            color: white;
            font-size: 2rem;
            animation: pulse 1.5s infinite;
        }

        /* ç…§ç‰‡åŒºåŸŸ */
        .photo-frame {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border-radius: 50%;
            border: 5px solid #ff6b6b;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
            flex-shrink: 0;
        }

        .photo-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* æ–‡å­—åŒºåŸŸ */
        .content {
            margin-bottom: 20px;
        }

        .timer {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 15px;
            font-family: monospace;
        }

        .love-letter {
            font-size: 1.1rem;
            line-height: 1.6;
            min-height: 100px;
            text-align: left;
            margin-bottom: 20px;
            white-space: pre-wrap; /* ä¿ç•™æ¢è¡Œ */
        }

        /* --- æŒ‰é’®åŒºåŸŸ (å…³é”®ä¿®æ”¹) --- */
        .buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            position: relative;
            height: 60px;
            width: 100%;
            
            /* é»˜è®¤éšè—ï¼Œé˜²æ­¢è¿˜æ²¡çœ‹å®Œå°±ç‚¹ */
            opacity: 0;
            pointer-events: none; 
            transition: opacity 2s ease;
        }

        /* æ˜¾ç¤ºæŒ‰é’®çš„ç±» */
        .buttons.show {
            opacity: 1;
            pointer-events: auto;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            outline: none;
            white-space: nowrap;
            z-index: 100;
        }

        .btn-yes {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .btn-yes:active {
            transform: scale(0.95);
        }

        .btn-no {
            background: #e0e0e0;
            color: #666;
            position: relative; /* åˆå§‹ç›¸å¯¹å®šä½ */
            transition: top 0.2s ease, left 0.2s ease;
        }

        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .container { padding: 20px; }
            .love-letter { font-size: 1rem; }
            .btn { padding: 10px 20px; font-size: 1rem; }
            .buttons { gap: 20px; }
        }
    </style>
</head>
<body>

    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bgm" loop>
        <!-- ã€è¯·ä¿®æ”¹è¿™é‡Œã€‘æ”¾å…¥ä½ çš„éŸ³ä¹æ–‡ä»¶ bgm.mp3 -->
        <source src="./bgm.mp3" type="audio/mpeg">
    </audio>

    <!-- åˆå§‹ç‚¹å‡»å±å¹• -->
    <div class="start-screen" id="startScreen" onclick="startProposal()">
        <h1>âœ¨ ç‚¹å‡»å¼€å¯ âœ¨</h1>
    </div>

    <!-- èƒŒæ™¯ Canvas -->
    <canvas id="heart-canvas"></canvas>

    <!-- ä¸»å†…å®¹å¡ç‰‡ -->
    <div class="container" id="mainContainer">
        <div class="photo-frame">
            <!-- ã€è¯·ä¿®æ”¹è¿™é‡Œã€‘æ”¾å…¥å¥¹çš„ç…§ç‰‡ photo.jpg -->
            <!-- è¿™é‡Œæš‚æ—¶ç”¨ç½‘å›¾å ä½ -->
            <img src="./photo.jpg" alt="Her Photo" id="gf-photo" onerror="this.src='https://api.dicebear.com/7.x/miniavs/svg?seed=Love'">
        </div>

        <div class="content">
            <div class="timer" id="timer">æˆ‘ä»¬å·²ç»ç›¸çˆ±äº†...</div>
            <div class="love-letter" id="typewriter"></div>
        </div>

        <div class="buttons">
            <button class="btn btn-yes" onclick="sheSaidYes()">æˆ‘æ„¿æ„ â¤</button>
            <button class="btn btn-no" id="btnNo" onmouseover="moveButton()" ontouchstart="moveButton()">å†æƒ³æƒ³</button>
        </div>
    </div>

    <script>
        // --- é…ç½®åŒºåŸŸ ã€è¯·ä¿®æ”¹è¿™é‡Œã€‘ ---
        const config = {
            startDate: "2024-04-10", // åœ¨ä¸€èµ·çš„æ—¥æœŸ
            // ä½ çš„æƒ…ä¹¦å†…å®¹
            loveLetter: `äº²çˆ±çš„å®å®ï¼š\n\nä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæˆ‘ä¹ æƒ¯äº†ç”¨ä»£ç å»è§£å†³é—®é¢˜ã€‚\nä½†é‡åˆ°ä½ ä¹‹åï¼Œæˆ‘å‘ç°çˆ±æ˜¯ä¸€ä¸ªæ— æ³•ç”¨é€»è¾‘é—­ç¯çš„æ­»å¾ªç¯ã€‚\n\nå¦‚æœæœ‰Bugï¼Œæˆ‘æ„¿ç”¨ä¸€è¾ˆå­å»Debugã€‚\nå¦‚æœå†…å­˜æº¢å‡ºï¼Œé‚£æ˜¯å› ä¸ºè£…æ»¡äº†å¯¹ä½ çš„å–œæ¬¢ã€‚\n\næœªæ¥çš„æ—¥å­ï¼Œä¸ç®¡æ˜¯æ­¤å¤–è¿˜æ˜¯å½¼ç«¯ï¼Œ\næˆ‘éƒ½æƒ³å’Œä½ ä¸€èµ· commit æ¯ä¸€å¤©çš„å¹¸ç¦ã€‚\n\nå«ç»™æˆ‘å¥½å—ï¼Ÿ`
        };

        // --- é€»è¾‘ä»£ç  ---

        function startProposal() {
            const startScreen = document.getElementById('startScreen');
            const mainContainer = document.getElementById('mainContainer');
            const bgm = document.getElementById('bgm');

            // å°è¯•æ’­æ”¾éŸ³ä¹
            bgm.play().catch(e => console.log("è¯·æ·»åŠ èƒŒæ™¯éŸ³ä¹æ–‡ä»¶"));

            startScreen.style.opacity = '0';
            setTimeout(() => {
                startScreen.style.display = 'none';
                mainContainer.style.display = 'block';
                startTimer();
                // ä¼ å…¥å›è°ƒï¼šå­—æ‰“å®Œäº†å†æ˜¾ç¤ºæŒ‰é’®
                typeWriter(config.loveLetter, 'typewriter', 100, () => {
                    document.querySelector('.buttons').classList.add('show');
                });
            }, 800);
        }

        // è®¡æ—¶å™¨
        function startTimer() {
            const timerElem = document.getElementById('timer');
            const start = new Date(config.startDate).getTime();
            setInterval(() => {
                const now = new Date().getTime();
                const distance = now - start;
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                timerElem.innerText = `ç›¸çˆ±ç¬¬ ${days} å¤© ${hours} å°æ—¶ ${minutes} åˆ† ${seconds} ç§’`;
            }, 1000);
        }

        // æ‰“å­—æœºæ•ˆæœ (å¸¦å›è°ƒ)
        function typeWriter(text, elementId, speed, callback) {
            let i = 0;
            const elem = document.getElementById(elementId);
            elem.innerHTML = "";
            
            function type() {
                if (i < text.length) {
                    elem.innerHTML += text.charAt(i) === '\n' ? '<br>' : text.charAt(i);
                    i++;
                    let delay = speed;
                    // æ ‡ç‚¹ç¬¦å·åœé¡¿æ„Ÿ
                    if (['ï¼Œ', 'ã€‚', 'ï¼', 'ï¼Ÿ', '\n'].includes(text.charAt(i-1))) delay += 200;
                    setTimeout(type, delay);
                } else {
                    if (callback) callback();
                }
            }
            type();
        }

        // æŒ‰é’®é€ƒé€¸é€»è¾‘
        let isFirstMove = true;
        function moveButton() {
            const btn = document.getElementById('btnNo');
            if (isFirstMove) {
                // ç¬¬ä¸€æ¬¡è§¦å‘æ—¶æ‰å˜æˆ fixedï¼Œé˜²æ­¢åˆå§‹å¸ƒå±€ä¹±æ‰
                btn.style.position = 'fixed'; 
                isFirstMove = false;
            }
            
            const maxWidth = window.innerWidth - btn.offsetWidth - 20;
            const maxHeight = window.innerHeight - btn.offsetHeight - 20;
            
            const randomX = Math.random() * maxWidth;
            const randomY = Math.random() * maxHeight;

            btn.style.left = randomX + 'px';
            btn.style.top = randomY + 'px';
        }

        // æˆ‘æ„¿æ„é€»è¾‘
        function sheSaidYes() {
            // 1. éšè—æ‹’ç»æŒ‰é’®
            document.getElementById('btnNo').style.display = 'none';
            
            // 2. æ”¹å˜æˆ‘æ„¿æ„æŒ‰é’®æ ·å¼
            const btnYes = document.querySelector('.btn-yes');
            btnYes.innerText = "â¤ï¸ çˆ±ä½ ä¸€ä¸‡å¹´ â¤ï¸";
            btnYes.style.transform = "scale(1.1)";
            btnYes.onclick = null; // ç¦æ­¢å†æ¬¡ç‚¹å‡»

            // 3. è¿½åŠ åº†ç¥æ–‡å­— (ä¸è¦†ç›–æƒ…ä¹¦)
            const letterDiv = document.querySelector('.love-letter');
            letterDiv.innerHTML += `
                <br><br>
                <div style="text-align: center; color: #ff6b6b; animation: fadeIn 1s;">
                    <hr style="border:0; border-top:1px dashed #ff6b6b; margin: 20px 0;">
                    <h3>ğŸ‰ She Said YES! ğŸ‰</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                        ä»£ç ç¼–è¯‘æˆåŠŸï¼Œç¨‹åºæ­£å¼ä¸Šçº¿ï¼<br>
                        ç‰ˆæœ¬å·ï¼šForever v1.0
                    </p>
                </div>
            `;
            
            // 4. å¼¹çª—ç¥ç¦
            setTimeout(() => {
                alert("ğŸ’– è°¢è°¢ä½ è®©æˆ‘æˆä¸ºä¸–ç•Œä¸Šæœ€å¹¸ç¦çš„äººï¼ ğŸ’–");
            }, 300);

            // 5. çˆ±å¿ƒé›¨åŠ é€Ÿ
            speedMultiplier = 6;
        }

        // --- Canvas çˆ±å¿ƒé›¨èƒŒæ™¯ ---
        const canvas = document.getElementById('heart-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let hearts = [];
        let speedMultiplier = 1;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Heart {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height - height;
                this.size = Math.random() * 15 + 5;
                this.speed = Math.random() * 2 + 1;
                this.color = `rgba(255, ${Math.random() * 100 + 100}, ${Math.random() * 100 + 100}, ${Math.random() * 0.5 + 0.1})`;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                let topCurveHeight = this.size * 0.3;
                ctx.moveTo(this.x, this.y + topCurveHeight);
                ctx.bezierCurveTo(this.x, this.y, this.x - this.size / 2, this.y, this.x - this.size / 2, this.y + topCurveHeight);
                ctx.bezierCurveTo(this.x - this.size / 2, this.y + (this.size + topCurveHeight) / 2, this.x, this.y + (this.size + topCurveHeight) / 2 + this.size / 2, this.x, this.y + this.size);
                ctx.bezierCurveTo(this.x, this.y + (this.size + topCurveHeight) / 2 + this.size / 2, this.x + this.size / 2, this.y + (this.size + topCurveHeight) / 2, this.x + this.size / 2, this.y + topCurveHeight);
                ctx.bezierCurveTo(this.x + this.size / 2, this.y, this.x, this.y, this.x, this.y + topCurveHeight);
                ctx.fill();
                ctx.closePath();
            }
            update() {
                this.y += this.speed * speedMultiplier;
                if (this.y > height) {
                    this.y = -50;
                    this.x = Math.random() * width;
                }
            }
        }

        function initHearts() { for (let i = 0; i < 60; i++) hearts.push(new Heart()); }
        function animateHearts() {
            ctx.clearRect(0, 0, width, height);
            hearts.forEach(heart => { heart.draw(); heart.update(); });
            requestAnimationFrame(animateHearts);
        }
        initHearts();
        animateHearts();
    </script>
</body>
</html>